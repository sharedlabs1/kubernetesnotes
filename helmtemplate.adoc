= Explanation of Helm Template for Kubernetes Deployment

This document explains the various components of a Kubernetes `Deployment` manifest file that is dynamically generated using Helm templating. The template is designed to create a robust and customizable deployment.

== API Version and Kind

[source,yaml]
----
apiVersion: apps/v1
kind: Deployment
----

- `apiVersion: apps/v1`: Specifies that this deployment resource uses the `apps/v1` API version.
- `kind: Deployment`: Indicates that the resource being defined is a Kubernetes `Deployment`.

== Metadata

[source,yaml]
----
metadata:
  name: {{ include "mychart2.fullname" . }}
  labels:
    {{- include "mychart2.labels" . | nindent 4 }}
----

- `metadata`: Contains metadata about the deployment.
  - `name`: The deployment name is dynamically generated using the Helm function `{{ include "mychart2.fullname" . }}`. This allows for a unique name that adheres to Helm’s naming conventions.
  - `labels`: A set of labels is applied to the deployment. The labels are generated by the `mychart2.labels` helper function, ensuring consistency across the chart.

== Spec (Specification)

[source,yaml]
----
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      {{- include "mychart2.selectorLabels" . | nindent 6 }}
----

- `spec`: Describes the desired state of the deployment.
  - `replicas`: Specifies the number of pod replicas that should be running. This value is fetched from the `values.yaml` file using `{{ .Values.replicaCount }}`.
  - `selector.matchLabels`: Defines the labels used to identify the pods managed by this deployment. The `mychart2.selectorLabels` helper function ensures that the labels are consistent across the deployment and its pods.

== Pod Template

[source,yaml]
----
template:
  metadata:
    {{- with .Values.podAnnotations }}
    annotations:
      {{- toYaml . | nindent 8 }}
    {{- end }}
    labels:
      {{- include "mychart2.selectorLabels" . | nindent 8 }}
----

- `template`: Defines the pod template, specifying how the pods should be configured.
  - `metadata`: Contains metadata for the pods.
    - `annotations`: Custom annotations can be applied to the pods. If any annotations are defined in the Helm values (`.Values.podAnnotations`), they are added here using the `toYaml` function, which formats them into YAML.
    - `labels`: Labels are applied to the pods using the `mychart2.selectorLabels` helper, ensuring they match the deployment’s selector labels.

== Container Specification

[source,yaml]
----
spec:
  containers:
    - name: {{ .Chart.Name }}
      image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
      imagePullPolicy: {{ .Values.image.pullPolicy }}
      ports:
        - name: http
          containerPort: {{ .Values.service.port }}
          protocol: TCP
----

- `spec.containers`: Defines the containers that will run in each pod.
  - `name`: The container name is set using the chart name (`{{ .Chart.Name }}`), which is derived from the Helm chart metadata.
  - `image`: The container image is specified using the repository and tag from the Helm values file. If the image tag is not defined, the `default` function falls back to the chart’s `AppVersion`.
  - `imagePullPolicy`: Specifies the image pull policy, controlled via `{{ .Values.image.pullPolicy }}`.
  - `ports`: Defines the container ports, in this case, an HTTP port, configured with the value `{{ .Values.service.port }}`.

== Liveness and Readiness Probes

[source,yaml]
----
livenessProbe:
  httpGet:
    path: /
    port: http
readinessProbe:
  httpGet:
    path: /
    port: http
----

- `livenessProbe`: Periodically checks if the container is still running. If the liveness probe fails, Kubernetes will restart the container. Here, the probe performs an HTTP GET request on the root path (`/`) of the container’s HTTP port.
- `readinessProbe`: Verifies that the container is ready to start serving traffic. If the readiness probe fails, the pod is marked as "not
